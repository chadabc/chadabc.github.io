"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[964],{16964:function(Zt,Dt,Ct){Ct.d(Dt,{rD:function(){return Pt}});var R=Ct(62435);function zt(s,n){var t=Object.keys(s);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(s);n&&(e=e.filter(function(i){return Object.getOwnPropertyDescriptor(s,i).enumerable})),t.push.apply(t,e)}return t}function N(s){for(var n=1;n<arguments.length;n++){var t=arguments[n]!=null?arguments[n]:{};n%2?zt(Object(t),!0).forEach(function(e){Ft(s,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(t)):zt(Object(t)).forEach(function(e){Object.defineProperty(s,e,Object.getOwnPropertyDescriptor(t,e))})}return s}function at(s,n){if(!(s instanceof n))throw new TypeError("Cannot call a class as a function")}function xt(s,n){for(var t=0;t<n.length;t++){var e=n[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(s,e.key,e)}}function ht(s,n,t){return n&&xt(s.prototype,n),t&&xt(s,t),s}function Ft(s,n,t){return n in s?Object.defineProperty(s,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[n]=t,s}function ct(s,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(n&&n.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),n&&lt(s,n)}function Z(s){return Z=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},Z(s)}function lt(s,n){return lt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},lt(s,n)}function Ht(s,n){if(n&&(typeof n=="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(s)}function ut(s){var n=function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=Z(s);if(n){var i=Z(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return Ht(this,t)}}var ft=function(s,n){return ft=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},ft(s,n)};function pt(s,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function t(){this.constructor=s}ft(s,n),s.prototype=n===null?Object.create(n):(t.prototype=n.prototype,new t)}var D=function(){return D=Object.assign||function(s){for(var n,t=1,e=arguments.length;t<e;t++)for(var i in n=arguments[t])Object.prototype.hasOwnProperty.call(n,i)&&(s[i]=n[i]);return s},D.apply(this,arguments)};function F(s,n,t,e){return new(t||(t=Promise))(function(i,r){function a(c){try{u(e.next(c))}catch(h){r(h)}}function o(c){try{u(e.throw(c))}catch(h){r(h)}}function u(c){var h;c.done?i(c.value):(h=c.value,h instanceof t?h:new t(function(l){l(h)})).then(a,o)}u((e=e.apply(s,n||[])).next())})}function H(s,n){var t,e,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(r[Symbol.iterator]=function(){return this}),r;function o(u){return function(c){return function(h){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,e&&(i=2&h[0]?e.return:h[0]?e.throw||((i=e.return)&&i.call(e),0):e.next)&&!(i=i.call(e,h[1])).done)return i;switch(e=0,i&&(h=[2&h[0],i.value]),h[0]){case 0:case 1:i=h;break;case 4:return a.label++,{value:h[1],done:!1};case 5:a.label++,e=h[1],h=[0];continue;case 7:h=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||h[0]!==6&&h[0]!==2)){a=0;continue}if(h[0]===3&&(!i||h[1]>i[0]&&h[1]<i[3])){a.label=h[1];break}if(h[0]===6&&a.label<i[1]){a.label=i[1],i=h;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(h);break}i[2]&&a.ops.pop(),a.trys.pop();continue}h=n.call(s,a)}catch(l){h=[6,l],e=0}finally{t=i=0}if(5&h[0])throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}([u,c])}}}function X(s,n){for(var t=0,e=n.length,i=s.length;t<e;t++,i++)s[i]=n[t];return s}Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(s,n){if(this==null)throw new TypeError('"this" is null or not defined');var t=Object(this),e=t.length>>>0;if(e===0)return!1;for(var i,r,a=0|n,o=Math.max(a>=0?a:e-Math.abs(a),0);o<e;){if((i=t[o])===(r=s)||typeof i=="number"&&typeof r=="number"&&isNaN(i)&&isNaN(r))return!0;o++}return!1}}),String.prototype.includes||(String.prototype.includes=function(s,n){return typeof n!="number"&&(n=0),!(n+s.length>this.length)&&this.indexOf(s,n)!==-1}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(s){if(this==null)throw new TypeError('"this" is null or not defined');var n=Object(this),t=n.length>>>0;if(typeof s!="function")throw new TypeError("predicate must be a function");for(var e=arguments[1],i=0;i<t;){var r=n[i];if(s.call(e,r,i,n))return r;i++}}});var J=function(s){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];return n.some(function(e){return Object.prototype.toString.call(s).slice(8,-1).toLowerCase()===e})},G=function(s,n){return Object.prototype.hasOwnProperty.call(s,n)},dt=function(s){return[].filter.call(s,function(n){return n!==`
`}).join("")},j=function(s){if(typeof s!="string"||(s=s.toLocaleLowerCase().trim())==="transparent")return!1;var n;return!(/^rgba/.test(s)&&((n=/([^\s,]+)\)$/.exec(s))===null?0:typeof n=="object"?NaN:typeof n=="number"?n:typeof n=="string"?n[n.length-1]==="%"?Number(n.slice(0,-1))/100:Number(n):NaN)===0)},Et=function(s,n){var t,e=((t=s.padding)===null||t===void 0?void 0:t.split(" ").map(function(h){return n(h)}))||[0],i=0,r=0,a=0,o=0;switch(e.length){case 1:i=r=a=o=e[0];break;case 2:i=r=e[0],a=o=e[1];break;case 3:i=e[0],a=o=e[1],r=e[2];break;default:i=e[0],r=e[1],a=e[2],o=e[3]}var u={paddingTop:i,paddingBottom:r,paddingLeft:a,paddingRight:o};for(var c in u)u[c]=G(s,c)&&J(s[c],"string","number")?n(s[c]):u[c];return[i,r,a,o]},Ot=function(s){var n=[],t=s.map(function(i){return Number(i)}).reduce(function(i,r){if(r>0){var a=i+r;return n.push(a),a}return n.push(NaN),i},0),e=Math.random()*t;return n.findIndex(function(i){return e<=i})},gt=function(s,n,t,e){e===void 0&&(e=1/0),e<=0&&(e=1/0);for(var i="",r=[],a=s.measureText("...").width,o=0;o<n.length;o++){i+=n[o];var u=s.measureText(i).width,c=t(r);if(e===r.length+1&&(u+=a),c<0)return r;if(u>c&&(r.push(i.slice(0,-1)),i=n[o]),e===r.length)return r[r.length-1]+="...",r}return i&&r.push(i),r.length||r.push(n),r},M=function(){function s(){this.subs=[]}return s.prototype.addSub=function(n){this.subs.includes(n)||this.subs.push(n)},s.prototype.notify=function(){this.subs.forEach(function(n){n.update()})},s}(),jt="__proto__"in{};function Lt(s,n,t,e){Object.defineProperty(s,n,{value:t,enumerable:!!e,writable:!0,configurable:!0})}var It=Array.prototype,tt=Object.create(It);["push","pop","shift","unshift","sort","splice","reverse"].forEach(function(s){tt[s]=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];var e=It[s].apply(this,n),i=this.__luckyOb__;return["push","unshift","splice"].includes(s)&&i.walk(this),i.dep.notify(),e}});var Mt=function(){function s(n){this.dep=new M,Lt(n,"__luckyOb__",this),Array.isArray(n)&&(jt?n.__proto__=tt:Object.getOwnPropertyNames(tt).forEach(function(t){Lt(n,t,tt[t])})),this.walk(n)}return s.prototype.walk=function(n){Object.keys(n).forEach(function(t){At(n,t,n[t])})},s}();function _t(s){if(s&&typeof s=="object")return"__luckyOb__"in s?s.__luckyOb__:new Mt(s)}function At(s,n,t){var e=new M,i=Object.getOwnPropertyDescriptor(s,n);if(!i||i.configurable!==!1){var r=i&&i.get,a=i&&i.set;r&&!a||arguments.length!==2||(t=s[n]);var o=_t(t);Object.defineProperty(s,n,{get:function(){var u=r?r.call(s):t;return M.target&&(e.addSub(M.target),o&&o.dep.addSub(M.target)),u},set:function(u){u!==t&&(t=u,r&&!a||(a?a.call(s,u):t=u,o=_t(u),e.notify()))}})}}var Bt=0,Nt=function(){function s(n,t,e,i){i===void 0&&(i={}),this.id=Bt++,this.$lucky=n,this.expr=t,this.deep=!!i.deep,this.getter=typeof t=="function"?t:function(r){r+=".";for(var a=[],o="",u=0;u<r.length;u++){var c=r[u];if(/\[|\./.test(c))a.push(o),o="";else{if(/\W/.test(c))continue;o+=c}}return function(h){return a.reduce(function(l,f){return l[f]},h)}}(t),this.cb=e,this.value=this.get()}return s.prototype.get=function(){M.target=this;var n=this.getter.call(this.$lucky,this.$lucky);return this.deep&&function(t){var e=function(i){J(i,"array","object")&&Object.keys(i).forEach(function(r){var a=i[r];e(a)})};e(t)}(n),M.target=null,n},s.prototype.update=function(){var n=this.get(),t=this.value;this.value=n,this.cb.call(this.$lucky,n,t)},s}(),vt=function(){function s(n,t){var e=this;this.version="1.7.25",this.htmlFontSize=16,this.rAF=function(){},this.boxWidth=0,this.boxHeight=0,typeof n=="string"?n={el:n}:n.nodeType===1&&(n={el:"",divElement:n}),n=n,this.config=n,this.data=t,n.flag||(n.flag="WEB"),n.el&&(n.divElement=document.querySelector(n.el)),n.divElement&&(n.canvasElement=document.createElement("canvas"),n.divElement.appendChild(n.canvasElement)),n.canvasElement&&(n.ctx=n.canvasElement.getContext("2d"),n.canvasElement.setAttribute("package","lucky-canvas@1.7.25"),n.canvasElement.addEventListener("click",function(i){return e.handleClick(i)})),this.ctx=n.ctx,this.initWindowFunction(),this.config.ctx||console.error("\u65E0\u6CD5\u83B7\u53D6\u5230 CanvasContext2D"),window&&typeof window.addEventListener=="function"&&window.addEventListener("resize",function(i,r){r===void 0&&(r=300);var a=null;return function(){for(var o=this,u=[],c=0;c<arguments.length;c++)u[c]=arguments[c];a||(a=setTimeout(function(){i.apply(o,u),clearTimeout(a),a=null},r))}}(function(){return e.resize()},300)),window&&typeof window.MutationObserver=="function"&&new window.MutationObserver(function(){e.resize()}).observe(document.documentElement,{attributes:!0})}return s.prototype.resize=function(){var n,t;(t=(n=this.config).beforeResize)===null||t===void 0||t.call(n),this.setHTMLFontSize(),this.setDpr(),this.resetWidthAndHeight(),this.zoomCanvas()},s.prototype.initLucky=function(){if(this.resize(),!this.boxWidth||!this.boxHeight)return console.error("\u65E0\u6CD5\u83B7\u53D6\u5230\u5BBD\u5EA6\u6216\u9AD8\u5EA6")},s.prototype.handleClick=function(n){},s.prototype.setHTMLFontSize=function(){window&&(this.htmlFontSize=+window.getComputedStyle(document.documentElement).fontSize.slice(0,-2))},s.prototype.clearCanvas=function(){var n=[this.boxWidth,this.boxHeight],t=n[0],e=n[1];this.ctx.clearRect(-t,-e,2*t,2*e)},s.prototype.setDpr=function(){var n=this.config;n.dpr||(window?window.dpr=n.dpr=window.devicePixelRatio||1:n.dpr||console.error(n,"\u672A\u4F20\u5165 dpr \u53EF\u80FD\u4F1A\u5BFC\u81F4\u7ED8\u5236\u5F02\u5E38"))},s.prototype.resetWidthAndHeight=function(){var n=this.config,t=this.data,e=0,i=0;n.divElement&&(e=n.divElement.offsetWidth,i=n.divElement.offsetHeight),this.boxWidth=this.getLength(t.width||n.width)||e,this.boxHeight=this.getLength(t.height||n.height)||i,n.divElement&&(n.divElement.style.overflow="hidden",n.divElement.style.width=this.boxWidth+"px",n.divElement.style.height=this.boxHeight+"px")},s.prototype.zoomCanvas=function(){var n=this.config,t=this.ctx,e=n.canvasElement,i=n.dpr,r=[this.boxWidth*i,this.boxHeight*i],a=r[0],o=r[1];e&&(e.width=a,e.height=o,e.style.width=a+"px",e.style.height=o+"px",e.style["transform-origin"]="left top",e.style.transform="scale("+1/i+")",t.scale(i,i))},s.prototype.initWindowFunction=function(){var n=this.config;if(window)return this.rAF=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},n.setTimeout=window.setTimeout,n.setInterval=window.setInterval,n.clearTimeout=window.clearTimeout,void(n.clearInterval=window.clearInterval);if(n.rAF)this.rAF=n.rAF;else if(n.setTimeout){var t=n.setTimeout;this.rAF=function(e){return t(e,16.7)}}else this.rAF=function(e){return setTimeout(e,16.7)}},s.prototype.isWeb=function(){return["WEB","UNI-H5","TARO-H5"].includes(this.config.flag)},s.prototype.loadImg=function(n,t,e){var i=this;return e===void 0&&(e="$resolve"),new Promise(function(r,a){if(n||a("=> '"+t.src+"' \u4E0D\u80FD\u4E3A\u7A7A\u6216\u4E0D\u5408\u6CD5"),i.config.flag!=="WEB")return t[e]=r,void(t.$reject=a);var o=new Image;o.onload=function(){return r(o)},o.onerror=function(){return a("=> '"+t.src+"' \u56FE\u7247\u52A0\u8F7D\u5931\u8D25")},o.src=n})},s.prototype.drawImage=function(n,t){for(var e,i,r,a=[],o=2;o<arguments.length;o++)a[o-2]=arguments[o];var u=this.config,c=u.flag,h=u.dpr;if(["WEB","MP-WX"].includes(c))r=t;else{if(!["UNI-H5","UNI-MP","TARO-H5","TARO-MP"].includes(c))return console.error("\u610F\u6599\u4E4B\u5916\u7684 flag, \u8BE5\u5E73\u53F0\u5C1A\u672A\u517C\u5BB9!");r=t.path}var l=(i=(e=r.canvas||r).getContext)===null||i===void 0?void 0:i.call(e,"2d");if(l&&!this.isWeb()){a=a.map(function(m){return m*h});var f=l.getImageData.apply(l,a.slice(0,4));n.putImageData.apply(n,X([f],a.slice(4,6)))}else{a.length===8&&(a=a.map(function(m,g){return g<4?m*h:m}));try{n.drawImage.apply(n,X([r],a))}catch(m){}}},s.prototype.computedWidthAndHeight=function(n,t,e,i){if(!t.width&&!t.height)return[n.width,n.height];if(t.width&&!t.height){var r=this.getLength(t.width,e);return[r,n.height*(r/n.width)]}if(!t.width&&t.height){var a=this.getLength(t.height,i);return[n.width*(a/n.height),a]}return[this.getLength(t.width,e),this.getLength(t.height,i)]},s.prototype.changeUnits=function(n,t){var e=this;t===void 0&&(t=1);var i=this.config;return Number(n.replace(/^([-]*[0-9.]*)([a-z%]*)$/,function(r,a,o){var u={"%":function(h){return h*(t/100)},px:function(h){return 1*h},rem:function(h){return h*e.htmlFontSize},vw:function(h){return h/100*window.innerWidth}}[o];if(u)return u(a);var c=i.handleCssUnit||i.unitFunc;return c?c(a,o):a}))},s.prototype.getLength=function(n,t){return J(n,"number")?n:J(n,"string")?this.changeUnits(n,t):0},s.prototype.getOffsetX=function(n,t){return t===void 0&&(t=0),(t-n)/2},s.prototype.getOffscreenCanvas=function(n,t){if(!G(this,"_offscreenCanvas")&&(window&&window.document&&this.config.flag==="WEB"?this._offscreenCanvas=document.createElement("canvas"):this._offscreenCanvas=this.config.offscreenCanvas,!this._offscreenCanvas))return console.error("\u79BB\u5C4F Canvas \u65E0\u6CD5\u6E32\u67D3!");var e=this.config.dpr,i=this._offscreenCanvas;i.width=(n||300)*e,i.height=(t||150)*e;var r=i.getContext("2d");return r.clearRect(0,0,n,t),r.scale(e,e),r.dpr=e,{_offscreenCanvas:i,_ctx:r}},s.prototype.$set=function(n,t,e){n&&typeof n=="object"&&At(n,t,e)},s.prototype.$computed=function(n,t,e){var i=this;Object.defineProperty(n,t,{get:function(){return e.call(i)}})},s.prototype.$watch=function(n,t,e){e===void 0&&(e={}),typeof t=="object"&&(t=(e=t).handler);var i=new Nt(this,n,t,e);return e.immediate&&t.call(this,i.value),function(){}},s.version="1.7.25",s}(),B=function(s){return Math.PI/180*s},et=function(s){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];var e=n[0],i=n[1],r=n[2],a=n[3],o=n[4],u=Math.min(r,a),c=Math.PI;o>u/2&&(o=u/2),s.beginPath(),s.moveTo(e+o,i),s.lineTo(e+o,i),s.lineTo(e+r-o,i),s.arc(e+r-o,i+o,o,-c/2,0),s.lineTo(e+r,i+a-o),s.arc(e+r-o,i+a-o,o,0,c/2),s.lineTo(e+o,i+a),s.arc(e+o,i+a-o,o,c/2,c),s.lineTo(e,i+o),s.arc(e+o,i+o,o,c,-c/2),s.closePath()},yt=function(s,n,t,e){return s>=e&&(s=e),t*(s/=e)*s+n},U=function(s,n,t,e){return s>=e&&(s=e),-t*(s/=e)*(s-2)+n},Xt=function(s){function n(t,e){var i,r=s.call(this,t,{width:e.width,height:e.height})||this;return r.blocks=[],r.prizes=[],r.buttons=[],r.defaultConfig={},r.defaultStyle={},r._defaultConfig={},r._defaultStyle={},r.Radius=0,r.prizeRadius=0,r.prizeDeg=0,r.prizeAng=0,r.rotateDeg=0,r.maxBtnRadius=0,r.startTime=0,r.endTime=0,r.stopDeg=0,r.endDeg=0,r.FPS=16.6,r.step=0,r.ImageCache=new Map,r.initData(e),r.initWatch(),r.initComputed(),(i=t.beforeCreate)===null||i===void 0||i.call(r),r.init(),r}return pt(n,s),n.prototype.resize=function(){var t,e;s.prototype.resize.call(this),this.Radius=Math.min(this.boxWidth,this.boxHeight)/2,this.ctx.translate(this.Radius,this.Radius),this.draw(),(e=(t=this.config).afterResize)===null||e===void 0||e.call(t)},n.prototype.initLucky=function(){this.Radius=0,this.prizeRadius=0,this.prizeDeg=0,this.prizeAng=0,this.rotateDeg=0,this.maxBtnRadius=0,this.startTime=0,this.endTime=0,this.stopDeg=0,this.endDeg=0,this.FPS=16.6,this.prizeFlag=-1,this.step=0,s.prototype.initLucky.call(this)},n.prototype.initData=function(t){this.$set(this,"width",t.width),this.$set(this,"height",t.height),this.$set(this,"blocks",t.blocks||[]),this.$set(this,"prizes",t.prizes||[]),this.$set(this,"buttons",t.buttons||[]),this.$set(this,"defaultConfig",t.defaultConfig||{}),this.$set(this,"defaultStyle",t.defaultStyle||{}),this.$set(this,"startCallback",t.start),this.$set(this,"endCallback",t.end)},n.prototype.initComputed=function(){var t=this;this.$computed(this,"_defaultConfig",function(){return D({gutter:"0px",offsetDegree:0,speed:20,speedFunction:"quad",accelerationTime:2500,decelerationTime:2500,stopRange:0},t.defaultConfig)}),this.$computed(this,"_defaultStyle",function(){return D({fontSize:"18px",fontColor:"#000",fontStyle:"sans-serif",fontWeight:"400",background:"rgba(0,0,0,0)",wordWrap:!0,lengthLimit:"90%"},t.defaultStyle)})},n.prototype.initWatch=function(){var t=this;this.$watch("width",function(e){t.data.width=e,t.resize()}),this.$watch("height",function(e){t.data.height=e,t.resize()}),this.$watch("blocks",function(e){t.initImageCache()},{deep:!0}),this.$watch("prizes",function(e){t.initImageCache()},{deep:!0}),this.$watch("buttons",function(e){t.initImageCache()},{deep:!0}),this.$watch("defaultConfig",function(){return t.draw()},{deep:!0}),this.$watch("defaultStyle",function(){return t.draw()},{deep:!0}),this.$watch("startCallback",function(){return t.init()}),this.$watch("endCallback",function(){return t.init()})},n.prototype.init=function(){var t,e;return F(this,void 0,void 0,function(){var i;return H(this,function(r){switch(r.label){case 0:return this.initLucky(),i=this.config,(t=i.beforeInit)===null||t===void 0||t.call(this),this.draw(),this.draw(),[4,this.initImageCache()];case 1:return r.sent(),(e=i.afterInit)===null||e===void 0||e.call(this),[2]}})})},n.prototype.initImageCache=function(){var t=this;return new Promise(function(e){var i={blocks:t.blocks.map(function(r){return r.imgs}),prizes:t.prizes.map(function(r){return r.imgs}),buttons:t.buttons.map(function(r){return r.imgs})};Object.keys(i).forEach(function(r){var a=i[r],o=[];a&&a.forEach(function(u,c){u&&u.forEach(function(h,l){o.push(t.loadAndCacheImg(r,c,l))})}),Promise.all(o).then(function(){t.draw(),e()})})})},n.prototype.handleClick=function(t){var e,i=this.ctx;i.beginPath(),i.arc(0,0,this.maxBtnRadius,0,2*Math.PI,!1),i.isPointInPath(t.offsetX,t.offsetY)&&this.step===0&&((e=this.startCallback)===null||e===void 0||e.call(this,t))},n.prototype.loadAndCacheImg=function(t,e,i){return F(this,void 0,void 0,function(){var r=this;return H(this,function(a){return[2,new Promise(function(o,u){var c=r[t][e];if(c&&c.imgs){var h=c.imgs[i];h&&r.loadImg(h.src,h).then(function(l){return F(r,void 0,void 0,function(){return H(this,function(f){switch(f.label){case 0:return typeof h.formatter!="function"?[3,2]:[4,Promise.resolve(h.formatter.call(this,l))];case 1:l=f.sent(),f.label=2;case 2:return this.ImageCache.set(h.src,l),o(),[2]}})})}).catch(function(l){console.error(t+"["+e+"].imgs["+i+"] "+l),u()})}})]})})},n.prototype.drawBlock=function(t,e,i){var r=this,a=this.ctx;j(e.background)&&(a.beginPath(),a.fillStyle=e.background,a.arc(0,0,t,0,2*Math.PI,!1),a.fill()),e.imgs&&e.imgs.forEach(function(o,u){var c=r.ImageCache.get(o.src);if(c){var h=r.computedWidthAndHeight(c,o,2*t,2*t),l=h[0],f=h[1],m=[r.getOffsetX(l)+r.getLength(o.left,2*t),r.getLength(o.top,2*t)-t],g=m[0],p=m[1];a.save(),o.rotate&&a.rotate(B(r.rotateDeg)),r.drawImage(a,c,g,p,l,f),a.restore()}})},n.prototype.draw=function(){var t,e,i=this,r=this,a=r.config,o=r.ctx,u=r._defaultConfig,c=r._defaultStyle;(t=a.beforeDraw)===null||t===void 0||t.call(this,o),o.clearRect(-this.Radius,-this.Radius,2*this.Radius,2*this.Radius),this.prizeRadius=this.blocks.reduce(function(g,p,d){return i.drawBlock(g,p,d),g-i.getLength(p.padding&&p.padding.split(" ")[0])},this.Radius),this.prizeDeg=360/this.prizes.length,this.prizeAng=B(this.prizeDeg);var h=this.prizeRadius*Math.sin(this.prizeAng/2)*2,l=B(this.rotateDeg-90+this.prizeDeg/2+u.offsetDegree),f=function(g,p){return i.getOffsetX(o.measureText(p).width)+i.getLength(g.left,h)},m=function(g,p,d){var y=g.lineHeight||c.lineHeight||g.fontSize||c.fontSize;return i.getLength(g.top,p)+(d+1)*i.getLength(y)};o.save(),this.prizes.forEach(function(g,p){var d=l+p*i.prizeAng,y=i.prizeRadius-i.maxBtnRadius,S=g.background||c.background;j(S)&&(o.fillStyle=S,function(w,v,C,z,x,L){w.beginPath();var E,O,_=B(90/Math.PI/C*L),I=z+_,A=x-_;w.arc(0,0,C,I,A,!1),w.lineTo.apply(w,(E=(z+x)/2,O=L/2/Math.abs(Math.sin((z-x)/2)),[+(Math.cos(E)*O).toFixed(8),+(Math.sin(E)*O).toFixed(8)])),w.closePath()}(o,i.maxBtnRadius,i.prizeRadius,d-i.prizeAng/2,d+i.prizeAng/2,i.getLength(u.gutter)),o.fill());var b=Math.cos(d)*i.prizeRadius,k=Math.sin(d)*i.prizeRadius;o.translate(b,k),o.rotate(d+B(90)),g.imgs&&g.imgs.forEach(function(w,v){var C=i.ImageCache.get(w.src);if(C){var z=i.computedWidthAndHeight(C,w,i.prizeAng*i.prizeRadius,y),x=z[0],L=z[1],E=[i.getOffsetX(x)+i.getLength(w.left,h),i.getLength(w.top,y)],O=E[0],_=E[1];i.drawImage(o,C,O,_,x,L)}}),g.fonts&&g.fonts.forEach(function(w){var v=w.fontColor||c.fontColor,C=w.fontWeight||c.fontWeight,z=i.getLength(w.fontSize||c.fontSize),x=w.fontStyle||c.fontStyle,L=G(w,"wordWrap")?w.wordWrap:c.wordWrap,E=w.lengthLimit||c.lengthLimit,O=w.lineClamp||c.lineClamp;o.fillStyle=v,o.font=C+" "+(z>>0)+"px "+x;var _=String(w.text);(L?gt(o,dt(_),function(I){var A=(i.prizeRadius-m(w,y,I.length))*Math.tan(i.prizeAng/2)*2-i.getLength(u.gutter);return i.getLength(E,A)},O):_.split(`
`)).filter(function(I){return!!I}).forEach(function(I,A){o.fillText(I,f(w,I),m(w,y,A))})}),o.rotate(B(360)-d-B(90)),o.translate(-b,-k)}),o.restore(),this.buttons.forEach(function(g,p){var d=i.getLength(g.radius,i.prizeRadius);i.maxBtnRadius=Math.max(i.maxBtnRadius,d),j(g.background)&&(o.beginPath(),o.fillStyle=g.background,o.arc(0,0,d,0,2*Math.PI,!1),o.fill()),g.pointer&&j(g.background)&&(o.beginPath(),o.fillStyle=g.background,o.moveTo(-d,0),o.lineTo(d,0),o.lineTo(0,2*-d),o.closePath(),o.fill()),g.imgs&&g.imgs.forEach(function(y,S){var b=i.ImageCache.get(y.src);if(b){var k=i.computedWidthAndHeight(b,y,2*d,2*d),w=k[0],v=k[1],C=[i.getOffsetX(w)+i.getLength(y.left,d),i.getLength(y.top,d)],z=C[0],x=C[1];i.drawImage(o,b,z,x,w,v)}}),g.fonts&&g.fonts.forEach(function(y){var S=y.fontColor||c.fontColor,b=y.fontWeight||c.fontWeight,k=i.getLength(y.fontSize||c.fontSize),w=y.fontStyle||c.fontStyle;o.fillStyle=S,o.font=b+" "+(k>>0)+"px "+w,String(y.text).split(`
`).forEach(function(v,C){o.fillText(v,f(y,v),m(y,d,C))})})}),(e=a.afterDraw)===null||e===void 0||e.call(this,o)},n.prototype.carveOnGunwaleOfAMovingBoat=function(){var t=this,e=t._defaultConfig,i=t.prizeFlag,r=t.prizeDeg,a=t.rotateDeg;this.endTime=Date.now();for(var o=this.stopDeg=a,u=e.speed,c=(Math.random()*r-r/2)*this.getLength(e.stopRange),h=0,l=0,f=0;++h;){var m=360*h-i*r-a-e.offsetDegree+c-r/2,g=U(this.FPS,o,m,e.decelerationTime)-o;if(g>u){this.endDeg=u-l>g-u?m:f;break}f=m,l=g}},n.prototype.play=function(){var t,e;this.step===0&&(this.startTime=Date.now(),this.prizeFlag=void 0,this.step=1,(e=(t=this.config).afterStart)===null||e===void 0||e.call(t),this.run())},n.prototype.stop=function(t){if(this.step!==0&&this.step!==3){if(!t&&t!==0){var e=this.prizes.map(function(i){return i.range});t=Ot(e)}t<0?(this.step=0,this.prizeFlag=-1):(this.step=2,this.prizeFlag=t%this.prizes.length)}},n.prototype.run=function(t){var e;t===void 0&&(t=0);var i=this,r=i.rAF,a=i.step,o=i.prizeFlag,u=i._defaultConfig,c=u.accelerationTime,h=u.decelerationTime,l=u.speed;if(a!==0){if(o!==-1){a!==3||this.endDeg||this.carveOnGunwaleOfAMovingBoat();var f=Date.now()-this.startTime,m=Date.now()-this.endTime,g=this.rotateDeg;if(a===1||f<c){this.FPS=f/t;var p=yt(f,0,l,c);p===l&&(this.step=2),g+=p%360}else a===2?(g+=l%360,o!==void 0&&o>=0&&(this.step=3,this.stopDeg=0,this.endDeg=0)):a===3?(g=U(m,this.stopDeg,this.endDeg,h),m>=h&&(this.step=0)):this.stop(-1);this.rotateDeg=g,this.draw(),r(this.run.bind(this,t+1))}}else(e=this.endCallback)===null||e===void 0||e.call(this,this.prizes.find(function(d,y){return y===o})||{})},n.prototype.conversionAxis=function(t,e){var i=this.config;return[t/i.dpr-this.Radius,e/i.dpr-this.Radius]},n}(vt),Gt=function(s){function n(t,e){var i,r=s.call(this,t,{width:e.width,height:e.height})||this;return r.rows=3,r.cols=3,r.blocks=[],r.prizes=[],r.buttons=[],r.defaultConfig={},r.defaultStyle={},r.activeStyle={},r._defaultConfig={},r._defaultStyle={},r._activeStyle={},r.cellWidth=0,r.cellHeight=0,r.startTime=0,r.endTime=0,r.currIndex=0,r.stopIndex=0,r.endIndex=0,r.demo=!1,r.timer=0,r.FPS=16.6,r.step=0,r.prizeFlag=-1,r.cells=[],r.ImageCache=new Map,r.initData(e),r.initWatch(),r.initComputed(),(i=t.beforeCreate)===null||i===void 0||i.call(r),r.init(),r}return pt(n,s),n.prototype.resize=function(){var t,e;s.prototype.resize.call(this),this.draw(),(e=(t=this.config).afterResize)===null||e===void 0||e.call(t)},n.prototype.initLucky=function(){this.cellWidth=0,this.cellHeight=0,this.startTime=0,this.endTime=0,this.currIndex=0,this.stopIndex=0,this.endIndex=0,this.demo=!1,this.timer=0,this.FPS=16.6,this.prizeFlag=-1,this.step=0,s.prototype.initLucky.call(this)},n.prototype.initData=function(t){this.$set(this,"width",t.width),this.$set(this,"height",t.height),this.$set(this,"rows",Number(t.rows)||3),this.$set(this,"cols",Number(t.cols)||3),this.$set(this,"blocks",t.blocks||[]),this.$set(this,"prizes",t.prizes||[]),this.$set(this,"buttons",t.buttons||[]),this.$set(this,"button",t.button),this.$set(this,"defaultConfig",t.defaultConfig||{}),this.$set(this,"defaultStyle",t.defaultStyle||{}),this.$set(this,"activeStyle",t.activeStyle||{}),this.$set(this,"startCallback",t.start),this.$set(this,"endCallback",t.end)},n.prototype.initComputed=function(){var t=this;this.$computed(this,"_defaultConfig",function(){var e=D({gutter:5,speed:20,accelerationTime:2500,decelerationTime:2500},t.defaultConfig);return e.gutter=t.getLength(e.gutter),e.speed=e.speed/40,e}),this.$computed(this,"_defaultStyle",function(){return D({borderRadius:20,fontColor:"#000",fontSize:"18px",fontStyle:"sans-serif",fontWeight:"400",background:"rgba(0,0,0,0)",shadow:"",wordWrap:!0,lengthLimit:"90%"},t.defaultStyle)}),this.$computed(this,"_activeStyle",function(){return D({background:"#ffce98",shadow:""},t.activeStyle)})},n.prototype.initWatch=function(){var t=this;this.$watch("width",function(e){t.data.width=e,t.resize()}),this.$watch("height",function(e){t.data.height=e,t.resize()}),this.$watch("blocks",function(e){t.initImageCache()},{deep:!0}),this.$watch("prizes",function(e){t.initImageCache()},{deep:!0}),this.$watch("buttons",function(e){t.initImageCache()},{deep:!0}),this.$watch("rows",function(){return t.init()}),this.$watch("cols",function(){return t.init()}),this.$watch("defaultConfig",function(){return t.draw()},{deep:!0}),this.$watch("defaultStyle",function(){return t.draw()},{deep:!0}),this.$watch("activeStyle",function(){return t.draw()},{deep:!0}),this.$watch("startCallback",function(){return t.init()}),this.$watch("endCallback",function(){return t.init()})},n.prototype.init=function(){var t,e;return F(this,void 0,void 0,function(){var i;return H(this,function(r){switch(r.label){case 0:return this.initLucky(),i=this.config,(t=i.beforeInit)===null||t===void 0||t.call(this),this.draw(),[4,this.initImageCache()];case 1:return r.sent(),(e=i.afterInit)===null||e===void 0||e.call(this),[2]}})})},n.prototype.initImageCache=function(){var t=this;return new Promise(function(e){var i=t.buttons.map(function(a){return a.imgs});t.button&&i.push(t.button.imgs);var r={blocks:t.blocks.map(function(a){return a.imgs}),prizes:t.prizes.map(function(a){return a.imgs}),buttons:i};Object.keys(r).forEach(function(a){var o=r[a],u=[];o&&o.forEach(function(c,h){c&&c.forEach(function(l,f){u.push(t.loadAndCacheImg(a,h,f))})}),Promise.all(u).then(function(){t.draw(),e()})})})},n.prototype.handleClick=function(t){var e=this,i=this.ctx;X(X([],this.buttons),[this.button]).forEach(function(r){var a;if(r){var o=e.getGeometricProperty([r.x,r.y,r.col||1,r.row||1]),u=o[0],c=o[1],h=o[2],l=o[3];i.beginPath(),i.rect(u,c,h,l),i.isPointInPath(t.offsetX,t.offsetY)&&e.step===0&&(typeof r.callback=="function"&&r.callback.call(e,r),(a=e.startCallback)===null||a===void 0||a.call(e,t,r))}})},n.prototype.loadAndCacheImg=function(t,e,i){return F(this,void 0,void 0,function(){var r=this;return H(this,function(a){return[2,new Promise(function(o,u){var c=r[t][e];if(t==="buttons"&&!r.buttons.length&&r.button&&(c=r.button),c&&c.imgs){var h=c.imgs[i];if(h){var l=[r.loadImg(h.src,h),h.activeSrc&&r.loadImg(h.activeSrc,h,"$activeResolve")];Promise.all(l).then(function(f){var m=f[0],g=f[1];return F(r,void 0,void 0,function(){var p;return H(this,function(d){switch(d.label){case 0:return typeof(p=h.formatter)!="function"?[3,3]:[4,Promise.resolve(p.call(this,m))];case 1:return m=d.sent(),g?[4,Promise.resolve(p.call(this,g))]:[3,3];case 2:g=d.sent(),d.label=3;case 3:return this.ImageCache.set(h.src,m),g&&this.ImageCache.set(h.activeSrc,g),o(),[2]}})})}).catch(function(f){console.error(t+"["+e+"].imgs["+i+"] "+f),u()})}}})]})})},n.prototype.draw=function(){var t,e,i=this,r=this,a=r.config,o=r.ctx,u=r._defaultConfig,c=r._defaultStyle,h=r._activeStyle;(t=a.beforeDraw)===null||t===void 0||t.call(this,o),o.clearRect(0,0,this.boxWidth,this.boxHeight),this.cells=X(X([],this.prizes),this.buttons),this.button&&this.cells.push(this.button),this.cells.forEach(function(l){l.col=l.col||1,l.row=l.row||1}),this.prizeArea=this.blocks.reduce(function(l,f,m){var g=l.x,p=l.y,d=l.w,y=l.h,S=Et(f,i.getLength.bind(i)),b=S[0],k=S[1],w=S[2],v=S[3],C=f.borderRadius?i.getLength(f.borderRadius):0,z=f.background;return j(z)&&(o.fillStyle=i.handleBackground(g,p,d,y,z),et(o,g,p,d,y,C),o.fill()),f.imgs&&f.imgs.forEach(function(x,L){var E=i.ImageCache.get(x.src);if(E){var O=i.computedWidthAndHeight(E,x,d,y),_=O[0],I=O[1],A=[i.getOffsetX(_,d)+i.getLength(x.left,d),i.getLength(x.top,y)],$=A[0],q=A[1];i.drawImage(o,E,g+$,p+q,_,I)}}),{x:g+w,y:p+b,w:d-w-v,h:y-b-k}},{x:0,y:0,w:this.boxWidth,h:this.boxHeight}),this.cellWidth=(this.prizeArea.w-u.gutter*(this.cols-1))/this.cols,this.cellHeight=(this.prizeArea.h-u.gutter*(this.rows-1))/this.rows,this.cells.forEach(function(l,f){var m=i.getGeometricProperty([l.x,l.y,l.col,l.row]),g=m[0],p=m[1],d=m[2],y=m[3],S=!1;(i.prizeFlag===void 0||i.prizeFlag>-1)&&(S=f===i.currIndex%i.prizes.length>>0);var b=S?h.background:l.background||c.background;if(j(b)){var k=(S?h.shadow:l.shadow||c.shadow).replace(/px/g,"").split(",")[0].split(" ").map(function(v,C){return C<3?Number(v):v});k.length===4&&(o.shadowColor=k[3],o.shadowOffsetX=k[0]*a.dpr,o.shadowOffsetY=k[1]*a.dpr,o.shadowBlur=k[2],k[0]>0?d-=k[0]:(d+=k[0],g-=k[0]),k[1]>0?y-=k[1]:(y+=k[1],p-=k[1])),o.fillStyle=i.handleBackground(g,p,d,y,b);var w=i.getLength(l.borderRadius?l.borderRadius:c.borderRadius);et(o,g,p,d,y,w),o.fill(),o.shadowColor="rgba(0, 0, 0, 0)",o.shadowOffsetX=0,o.shadowOffsetY=0,o.shadowBlur=0}f>=i.prizes.length&&(f-=i.prizes.length),l.imgs&&l.imgs.forEach(function(v,C){var z=i.ImageCache.get(v.src),x=i.ImageCache.get(v.activeSrc);if(z){var L=S&&x||z;if(L){var E=i.computedWidthAndHeight(L,v,d,y),O=E[0],_=E[1],I=[g+i.getOffsetX(O,d)+i.getLength(v.left,d),p+i.getLength(v.top,y)],A=I[0],$=I[1];i.drawImage(o,L,A,$,O,_)}}}),l.fonts&&l.fonts.forEach(function(v){var C=S&&h.fontStyle?h.fontStyle:v.fontStyle||c.fontStyle,z=S&&h.fontWeight?h.fontWeight:v.fontWeight||c.fontWeight,x=S&&h.fontSize?i.getLength(h.fontSize):i.getLength(v.fontSize||c.fontSize),L=S&&h.lineHeight?h.lineHeight:v.lineHeight||c.lineHeight||v.fontSize||c.fontSize,E=G(v,"wordWrap")?v.wordWrap:c.wordWrap,O=v.lengthLimit||c.lengthLimit,_=v.lineClamp||c.lineClamp;o.font=z+" "+(x>>0)+"px "+C,o.fillStyle=S&&h.fontColor?h.fontColor:v.fontColor||c.fontColor;var I=[],A=String(v.text);if(E){var $=i.getLength(O,d);I=gt(o,dt(A),function(){return $},_)}else I=A.split(`
`);I.forEach(function(q,wt){o.fillText(q,g+i.getOffsetX(o.measureText(q).width,d)+i.getLength(v.left,d),p+i.getLength(v.top,y)+(wt+1)*i.getLength(L))})})}),(e=a.afterDraw)===null||e===void 0||e.call(this,o)},n.prototype.handleBackground=function(t,e,i,r,a){var o=this.ctx;return a.includes("linear-gradient")&&(a=function(u,c,h,l,f,m){var g=/linear-gradient\((.+)\)/.exec(m)[1].split(",").map(function(b){return b.trim()}),p=g.shift(),d=[0,0,0,0];if(p.includes("deg")){var y=function(b){return Math.tan(b/180*Math.PI)};(p=p.slice(0,-3)%360)>=0&&p<45?d=[c,h+f,c+l,h+f-l*y(p-0)]:p>=45&&p<90?d=[c,h+f,c+l-f*y(p-45),h]:p>=90&&p<135?d=[c+l,h+f,c+l-f*y(p-90),h]:p>=135&&p<180?d=[c+l,h+f,c,h+l*y(p-135)]:p>=180&&p<225?d=[c+l,h,c,h+l*y(p-180)]:p>=225&&p<270?d=[c+l,h,c+f*y(p-225),h+f]:p>=270&&p<315?d=[c,h,c+f*y(p-270),h+f]:p>=315&&p<360&&(d=[c,h,c+l,h+f-l*y(p-315)])}else p.includes("top")?d=[c,h+f,c,h]:p.includes("bottom")?d=[c,h,c,h+f]:p.includes("left")?d=[c+l,h,c,h]:p.includes("right")&&(d=[c,h,c+l,h]);var S=u.createLinearGradient.apply(u,d.map(function(b){return b>>0}));return g.reduce(function(b,k,w){var v=k.split(" ");return v.length===1?b.addColorStop(w,v[0]):v.length===2&&b.addColorStop.apply(b,v),b},S)}(o,t,e,i,r,a)),a},n.prototype.carveOnGunwaleOfAMovingBoat=function(){var t=this,e=t._defaultConfig,i=t.prizeFlag,r=t.currIndex;this.endTime=Date.now();for(var a=this.stopIndex=r,o=e.speed,u=0,c=0,h=0;++u;){var l=this.prizes.length*u+i-a,f=U(this.FPS,a,l,e.decelerationTime)-a;if(f>o){this.endIndex=o-c>f-o?l:h;break}h=l,c=f}},n.prototype.play=function(){var t,e;this.step===0&&(this.startTime=Date.now(),this.prizeFlag=void 0,this.step=1,(e=(t=this.config).afterStart)===null||e===void 0||e.call(t),this.run())},n.prototype.stop=function(t){if(this.step!==0&&this.step!==3){if(!t&&t!==0){var e=this.prizes.map(function(i){return i.range});t=Ot(e)}t<0?(this.step=0,this.prizeFlag=-1):(this.step=2,this.prizeFlag=t%this.prizes.length)}},n.prototype.run=function(t){var e;t===void 0&&(t=0);var i=this,r=i.rAF,a=i.step,o=i.prizes,u=i.prizeFlag,c=i._defaultConfig,h=c.accelerationTime,l=c.decelerationTime,f=c.speed;if(a!==0){if(u!==-1){a!==3||this.endIndex||this.carveOnGunwaleOfAMovingBoat();var m=Date.now()-this.startTime,g=Date.now()-this.endTime,p=this.currIndex;if(a===1||m<h){this.FPS=m/t;var d=yt(m,.1,f-.1,h);d===f&&(this.step=2),p+=d%o.length}else a===2?(p+=f%o.length,u!==void 0&&u>=0&&(this.step=3,this.stopIndex=0,this.endIndex=0)):a===3?(p=U(g,this.stopIndex,this.endIndex,l),g>=l&&(this.step=0)):this.stop(-1);this.currIndex=p,this.draw(),r(this.run.bind(this,t+1))}}else(e=this.endCallback)===null||e===void 0||e.call(this,this.prizes.find(function(y,S){return S===u})||{})},n.prototype.getGeometricProperty=function(t){var e=t[0],i=t[1],r=t[2],a=r===void 0?1:r,o=t[3],u=o===void 0?1:o,c=this.cellWidth,h=this.cellHeight,l=this._defaultConfig.gutter,f=[this.prizeArea.x+(c+l)*e,this.prizeArea.y+(h+l)*i];return a&&u&&f.push(c*a+l*(a-1),h*u+l*(u-1)),f},n.prototype.conversionAxis=function(t,e){var i=this.config;return[t/i.dpr,e/i.dpr]},n}(vt),Ut=function(s){function n(t,e){var i,r=s.call(this,t,{width:e.width,height:e.height})||this;return r.blocks=[],r.prizes=[],r.slots=[],r.defaultConfig={},r._defaultConfig={},r.defaultStyle={},r._defaultStyle={},r.endCallback=function(){},r.cellWidth=0,r.cellHeight=0,r.cellAndSpacing=0,r.widthAndSpacing=0,r.heightAndSpacing=0,r.FPS=16.6,r.scroll=[],r.stopScroll=[],r.endScroll=[],r.startTime=0,r.endTime=0,r.step=0,r.prizeFlag=void 0,r.ImageCache=new Map,r.initData(e),r.initWatch(),r.initComputed(),(i=t.beforeCreate)===null||i===void 0||i.call(r),r.init(),r}return pt(n,s),n.prototype.resize=function(){var t,e;s.prototype.resize.call(this),this.draw(),(e=(t=this.config).afterResize)===null||e===void 0||e.call(t)},n.prototype.initLucky=function(){this.cellWidth=0,this.cellHeight=0,this.cellAndSpacing=0,this.widthAndSpacing=0,this.heightAndSpacing=0,this.FPS=16.6,this.scroll=[],this.stopScroll=[],this.endScroll=[],this.startTime=0,this.endTime=0,this.prizeFlag=void 0,this.step=0,s.prototype.initLucky.call(this)},n.prototype.initData=function(t){this.$set(this,"width",t.width),this.$set(this,"height",t.height),this.$set(this,"blocks",t.blocks||[]),this.$set(this,"prizes",t.prizes||[]),this.$set(this,"slots",t.slots||[]),this.$set(this,"defaultConfig",t.defaultConfig||{}),this.$set(this,"defaultStyle",t.defaultStyle||{}),this.$set(this,"endCallback",t.end)},n.prototype.initComputed=function(){var t=this;this.$computed(this,"_defaultConfig",function(){var e=D({mode:"vertical",rowSpacing:0,colSpacing:5,speed:20,direction:1,accelerationTime:2500,decelerationTime:2500},t.defaultConfig);return e.rowSpacing=t.getLength(e.rowSpacing),e.colSpacing=t.getLength(e.colSpacing),e}),this.$computed(this,"_defaultStyle",function(){return D({borderRadius:0,fontColor:"#000",fontSize:"18px",fontStyle:"sans-serif",fontWeight:"400",background:"rgba(0,0,0,0)",wordWrap:!0,lengthLimit:"90%"},t.defaultStyle)})},n.prototype.initWatch=function(){var t=this;this.$watch("width",function(e){t.data.width=e,t.resize()}),this.$watch("height",function(e){t.data.height=e,t.resize()}),this.$watch("blocks",function(e){t.initImageCache()},{deep:!0}),this.$watch("prizes",function(e){t.initImageCache()},{deep:!0}),this.$watch("slots",function(e){t.drawOffscreenCanvas(),t.draw()},{deep:!0}),this.$watch("defaultConfig",function(){return t.draw()},{deep:!0}),this.$watch("defaultStyle",function(){return t.draw()},{deep:!0}),this.$watch("endCallback",function(){return t.init()})},n.prototype.init=function(){var t,e;return F(this,void 0,void 0,function(){var i;return H(this,function(r){switch(r.label){case 0:return this.initLucky(),i=this.config,(t=i.beforeInit)===null||t===void 0||t.call(this),this.drawOffscreenCanvas(),this.draw(),[4,this.initImageCache()];case 1:return r.sent(),(e=i.afterInit)===null||e===void 0||e.call(this),[2]}})})},n.prototype.initImageCache=function(){var t=this;return new Promise(function(e){var i={blocks:t.blocks.map(function(r){return r.imgs}),prizes:t.prizes.map(function(r){return r.imgs})};Object.keys(i).forEach(function(r){var a=i[r],o=[];a&&a.forEach(function(u,c){u&&u.forEach(function(h,l){o.push(t.loadAndCacheImg(r,c,l))})}),Promise.all(o).then(function(){t.drawOffscreenCanvas(),t.draw(),e()})})})},n.prototype.loadAndCacheImg=function(t,e,i){return F(this,void 0,void 0,function(){var r=this;return H(this,function(a){return[2,new Promise(function(o,u){var c=r[t][e];if(c&&c.imgs){var h=c.imgs[i];h&&r.loadImg(h.src,h).then(function(l){return F(r,void 0,void 0,function(){return H(this,function(f){switch(f.label){case 0:return typeof h.formatter!="function"?[3,2]:[4,Promise.resolve(h.formatter.call(this,l))];case 1:l=f.sent(),f.label=2;case 2:return this.ImageCache.set(h.src,l),o(),[2]}})})}).catch(function(l){console.error(t+"["+e+"].imgs["+i+"] "+l),u()})}})]})})},n.prototype.drawOffscreenCanvas=function(){var t=this,e=this._defaultConfig,i=this._defaultStyle,r=this.drawBlocks(),a=r.w,o=r.h,u=this.prizes.length,c=this.displacementWidthOrHeight(),h=c.cellWidth,l=c.cellHeight,f=c.widthAndSpacing,m=c.heightAndSpacing,g=new Array(u).fill(void 0).map(function(k,w){return w}),p=0,d=0;this.slots.forEach(function(k,w){t.scroll[w]===void 0&&(t.scroll[w]=0),k.order=k.order||g;var v=k.order.length;p=Math.max(p,a+f*v),d=Math.max(d,o+m*v)});var y=this.getOffscreenCanvas(p,d),S=y._offscreenCanvas,b=y._ctx;this._offscreenCanvas=S,this.slots.forEach(function(k,w){var v=h*w,C=l*w,z=0,x=function(W,Y){for(var it={},nt=[],T=0;T<W.length;T++)it[T]=W[T];for(T=0;T<Y.length;T++){var K=it[Y[T]];K&&(nt[T]=K)}return nt}(t.prizes,k.order);if(x.length){x.forEach(function(W,Y){if(W){k.order[Y];var it=f*Y+e.colSpacing/2,nt=m*Y+e.rowSpacing/2,T=t.displacement([v,nt,m],[it,C,f]),K=T[0],bt=T[1],Kt=T[2];z+=Kt;var Tt=W.background||i.background;if(j(Tt)){var Jt=t.getLength(G(W,"borderRadius")?W.borderRadius:i.borderRadius);et(b,K,bt,h,h,Jt),b.fillStyle=Tt,b.fill()}W.imgs&&W.imgs.forEach(function(P,Wt){var Q=t.ImageCache.get(P.src);if(Q){var rt=t.computedWidthAndHeight(Q,P,h,l),ot=rt[0],kt=rt[1],st=[K+t.getOffsetX(ot,h)+t.getLength(P.left,h),bt+t.getLength(P.top,l)],St=st[0],V=st[1];t.drawImage(b,Q,St,V,ot,kt)}}),W.fonts&&W.fonts.forEach(function(P){var Wt=P.fontStyle||i.fontStyle,Q=P.fontWeight||i.fontWeight,rt=t.getLength(P.fontSize||i.fontSize),ot=P.lineHeight||i.lineHeight||P.fontSize||i.fontSize,kt=G(P,"wordWrap")?P.wordWrap:i.wordWrap,st=P.lengthLimit||i.lengthLimit,St=P.lineClamp||i.lineClamp;b.font=Q+" "+(rt>>0)+"px "+Wt,b.fillStyle=P.fontColor||i.fontColor;var V=[],$t=String(P.text);if(kt){var Qt=t.getLength(st,h);V=gt(b,dt($t),function(){return Qt},St)}else V=$t.split(`
`);V.forEach(function(Rt,Vt){b.fillText(Rt,K+t.getOffsetX(b.measureText(Rt).width,h)+t.getLength(P.left,h),bt+t.getLength(P.top,l)+(Vt+1)*t.getLength(ot))})})}});for(var L=t.displacement([v,0,h,z],[0,C,z,l]),E=L[0],O=L[1],_=L[2],I=L[3],A=z;A<d+z;){var $=t.displacement([E,A],[A,O]),q=$[0],wt=$[1];t.drawImage(b,S,E,O,_,I,q,wt,_,I),A+=z}}})},n.prototype.drawBlocks=function(){var t=this,e=this;e.config;var i=e.ctx;e._defaultConfig;var r=e._defaultStyle;return this.prizeArea=this.blocks.reduce(function(a,o,u){var c=a.x,h=a.y,l=a.w,f=a.h,m=Et(o,t.getLength.bind(t)),g=m[0],p=m[1],d=m[2],y=m[3],S=o.borderRadius?t.getLength(o.borderRadius):0,b=o.background||r.background;return j(b)&&(et(i,c,h,l,f,S),i.fillStyle=b,i.fill()),o.imgs&&o.imgs.forEach(function(k,w){var v=t.ImageCache.get(k.src);if(v){var C=t.computedWidthAndHeight(v,k,l,f),z=C[0],x=C[1],L=[t.getOffsetX(z,l)+t.getLength(k.left,l),t.getLength(k.top,f)],E=L[0],O=L[1];t.drawImage(i,v,c+E,h+O,z,x)}}),{x:c+d,y:h+g,w:l-d-y,h:f-g-p}},{x:0,y:0,w:this.boxWidth,h:this.boxHeight})},n.prototype.draw=function(){var t,e=this,i=this,r=i.config,a=i.ctx;i._defaultConfig,i._defaultStyle,(t=r.beforeDraw)===null||t===void 0||t.call(this,a),a.clearRect(0,0,this.boxWidth,this.boxHeight);var o=this.drawBlocks(),u=o.x,c=o.y,h=o.w,l=o.h;if(this._offscreenCanvas){var f=this,m=f.cellWidth,g=f.cellHeight,p=f.cellAndSpacing,d=f.widthAndSpacing,y=f.heightAndSpacing;this.slots.forEach(function(S,b){var k=p*S.order.length,w=e.displacement(-(l-y)/2,-(h-d)/2),v=e.scroll[b]+w;v<0&&(v=v%k+k),v>k&&(v%=k);var C=e.displacement([m*b,v,m,l],[v,g*b,h,g]),z=C[0],x=C[1],L=C[2],E=C[3],O=e.displacement([u+d*b,c,m,l],[u,c+y*b,h,g]),_=O[0],I=O[1],A=O[2],$=O[3];e.drawImage(a,e._offscreenCanvas,z,x,L,E,_,I,A,$)})}},n.prototype.carveOnGunwaleOfAMovingBoat=function(){var t=this,e=this,i=e._defaultConfig,r=e.prizeFlag,a=e.cellAndSpacing;this.endTime=Date.now(),this.slots.forEach(function(o,u){var c=o.order;if(c.length)for(var h=o.speed||i.speed,l=o.direction||i.direction,f=c.findIndex(function(S){return S===r[u]}),m=a*c.length,g=t.stopScroll[u]=t.scroll[u],p=0;++p;){var d=a*f+m*p*l-g,y=U(t.FPS,g,d,i.decelerationTime)-g;if(Math.abs(y)>h){t.endScroll[u]=d;break}}})},n.prototype.play=function(){var t,e;this.step===0&&(this.startTime=Date.now(),this.prizeFlag=void 0,this.step=1,(e=(t=this.config).afterStart)===null||e===void 0||e.call(t),this.run())},n.prototype.stop=function(t){var e;if(this.step!==0&&this.step!==3){if(typeof t=="number")this.prizeFlag=new Array(this.slots.length).fill(t);else{if(!J(t,"array"))return this.stop(-1),console.error("stop() \u65E0\u6CD5\u8BC6\u522B\u7684\u53C2\u6570\u7C7B\u578B "+typeof t);if(t.length!==this.slots.length)return this.stop(-1),console.error("stop(["+t+"]) \u53C2\u6570\u957F\u5EA6\u7684\u4E0D\u6B63\u786E");this.prizeFlag=t}!((e=this.prizeFlag)===null||e===void 0)&&e.includes(-1)?(this.prizeFlag=[],this.step=0):this.step=2}},n.prototype.run=function(t){var e,i,r=this;t===void 0&&(t=0);var a=this,o=a.rAF,u=a.step,c=a.prizeFlag,h=a._defaultConfig,l=a.cellAndSpacing,f=a.slots,m=h.accelerationTime,g=h.decelerationTime;if(this.step!==0||(c==null?void 0:c.length)!==f.length){if(c===void 0||c.length){this.step!==3||this.endScroll.length||this.carveOnGunwaleOfAMovingBoat();var p=Date.now()-this.startTime,d=Date.now()-this.endTime;f.forEach(function(w,v){var C=w.order;if(C&&C.length){var z=l*C.length,x=Math.abs(w.speed||h.speed),L=w.direction||h.direction,E=0,O=r.scroll[v];if(u===1||p<m){r.FPS=p/t;var _=yt(p,0,x,m);_===x&&(r.step=2),E=(O+_*L)%z}else if(u===2)E=(O+x*L)%z,(c==null?void 0:c.length)===f.length&&(r.step=3,r.stopScroll=[],r.endScroll=[]);else if(u===3&&d){var I=r.stopScroll[v],A=r.endScroll[v];E=U(d,I,A,g),d>=g&&(r.step=0)}r.scroll[v]=E}}),this.draw(),o(this.run.bind(this,t+1))}}else{for(var y=c[0],S=0;S<f.length;S++){var b=f[S],k=c[S];if(!(!((e=b.order)===null||e===void 0)&&e.includes(k))||y!==k){y=-1;break}}(i=this.endCallback)===null||i===void 0||i.call(this,this.prizes.find(function(w,v){return v===y})||void 0)}},n.prototype.displacement=function(t,e){return this._defaultConfig.mode==="horizontal"?e:t},n.prototype.displacementWidthOrHeight=function(){var t=this._defaultConfig.mode,e=this.slots.length,i=this._defaultConfig,r=i.colSpacing,a=i.rowSpacing,o=this.prizeArea||this.drawBlocks();o.x,o.y;var u,c,h=o.w,l=o.h,f=0,m=0;return t==="horizontal"?(m=this.cellHeight=(l-a*(e-1))/e,f=this.cellWidth=m):(f=this.cellWidth=(h-r*(e-1))/e,m=this.cellHeight=f),u=this.widthAndSpacing=this.cellWidth+r,c=this.heightAndSpacing=this.cellHeight+a,this.cellAndSpacing=t==="horizontal"?u:c,{cellWidth:f,cellHeight:m,widthAndSpacing:u,heightAndSpacing:c}},n}(vt),mt="@lucky-canvas/react",Pt=function(s){ct(t,R.Component);var n=ut(t);function t(e){var i;return at(this,t),(i=n.call(this,e)).myLucky=R.createRef(),i.lucky=void 0,i}return ht(t,[{key:"componentDidMount",value:function(){if(!this.lucky){this.myLucky.current.setAttribute("package","".concat(mt,"@").concat("0.1.13"));try{this.initLucky(),this.props.onSuccess&&this.props.onSuccess()}catch(e){this.props.onError&&this.props.onError(e)}finally{this.props.onFinally&&this.props.onFinally()}}}},{key:"componentDidUpdate",value:function(e){this.lucky&&(this.props.width!==e.width&&(this.lucky.width=this.props.width),this.props.height!==e.height&&(this.lucky.height=this.props.height),this.props.blocks!==e.blocks&&(this.lucky.blocks=this.props.blocks),this.props.prizes!==e.prizes&&(this.lucky.prizes=this.props.prizes),this.props.buttons!==e.buttons&&(this.lucky.buttons=this.props.buttons))}},{key:"initLucky",value:function(){var e=this;this.lucky=new Xt({flag:"WEB",divElement:this.myLucky.current},N(N({},this.props),{},{start:function(){var i;e.props.onStart&&(i=e.props).onStart.apply(i,arguments)},end:function(){var i;e.props.onEnd&&(i=e.props).onEnd.apply(i,arguments)}}))}},{key:"init",value:function(){var e;(e=this.lucky).init.apply(e,arguments)}},{key:"play",value:function(){var e;(e=this.lucky).play.apply(e,arguments)}},{key:"stop",value:function(){var e;(e=this.lucky).stop.apply(e,arguments)}},{key:"render",value:function(){return R.createElement("div",{ref:this.myLucky})}}]),t}();Pt.defaultProps={width:"",height:"",prizes:[],blocks:[],buttons:[],defaultStyle:{},defaultConfig:{}};var qt=function(s){ct(t,R.Component);var n=ut(t);function t(e){var i;return at(this,t),(i=n.call(this,e)).myLucky=R.createRef(),i.lucky=void 0,i}return ht(t,[{key:"componentDidMount",value:function(){if(!this.lucky){this.myLucky.current.setAttribute("package","".concat(mt,"@").concat("0.1.13"));try{this.initLucky(),this.props.onSuccess&&this.props.onSuccess()}catch(e){this.props.onError&&this.props.onError(e)}finally{this.props.onFinally&&this.props.onFinally(err)}}}},{key:"componentDidUpdate",value:function(e){this.lucky&&(this.props.width!==e.width&&(this.lucky.width=this.props.width),this.props.height!==e.height&&(this.lucky.height=this.props.height),this.props.cols!==e.cols&&(this.lucky.cols=this.props.cols),this.props.rows!==e.rows&&(this.lucky.rows=this.props.rows),this.props.blocks!==e.blocks&&(this.lucky.blocks=this.props.blocks),this.props.prizes!==e.prizes&&(this.lucky.prizes=this.props.prizes),this.props.buttons!==e.buttons&&(this.lucky.buttons=this.props.buttons))}},{key:"initLucky",value:function(){var e=this;this.lucky=new Gt({flag:"WEB",divElement:this.myLucky.current},N(N({},this.props),{},{start:function(){var i;e.props.onStart&&(i=e.props).onStart.apply(i,arguments)},end:function(){var i;e.props.onEnd&&(i=e.props).onEnd.apply(i,arguments)}}))}},{key:"init",value:function(){var e;(e=this.$lucky).init.apply(e,arguments)}},{key:"play",value:function(){var e;(e=this.lucky).play.apply(e,arguments)}},{key:"stop",value:function(){var e;(e=this.lucky).stop.apply(e,arguments)}},{key:"render",value:function(){return R.createElement("div",{ref:this.myLucky})}}]),t}();qt.defaultProps={width:"",height:"",cols:3,rows:3,blocks:[],prizes:[],buttons:[],defaultStyle:{},activeStyle:{},defaultConfig:{}};var Yt=function(s){ct(t,R.Component);var n=ut(t);function t(e){var i;return at(this,t),(i=n.call(this,e)).myLucky=R.createRef(),i.lucky=void 0,i}return ht(t,[{key:"componentDidMount",value:function(){if(!this.lucky){this.myLucky.current.setAttribute("package","".concat(mt,"@").concat("0.1.13"));try{this.initLucky(),this.props.onSuccess&&this.props.onSuccess()}catch(e){this.props.onError&&this.props.onError(e)}finally{this.props.onFinally&&this.props.onFinally(err)}}}},{key:"componentDidUpdate",value:function(e){this.lucky&&(this.props.width!==e.width&&(this.lucky.width=this.props.width),this.props.height!==e.height&&(this.lucky.height=this.props.height),this.props.blocks!==e.blocks&&(this.lucky.blocks=this.props.blocks),this.props.prizes!==e.prizes&&(this.lucky.prizes=this.props.prizes),this.props.slots!==e.slots&&(this.lucky.slots=this.props.slots))}},{key:"initLucky",value:function(){var e=this;this.lucky=new Ut({flag:"WEB",divElement:this.myLucky.current},N(N({},this.props),{},{start:function(){var i;e.props.onStart&&(i=e.props).onStart.apply(i,arguments)},end:function(){var i;e.props.onEnd&&(i=e.props).onEnd.apply(i,arguments)}}))}},{key:"init",value:function(){var e;(e=this.lucky).init.apply(e,arguments)}},{key:"play",value:function(){var e;(e=this.lucky).play.apply(e,arguments)}},{key:"stop",value:function(){var e;(e=this.lucky).stop.apply(e,arguments)}},{key:"render",value:function(){return R.createElement("div",{ref:this.myLucky})}}]),t}();Yt.defaultProps={width:"",height:"",blocks:[],prizes:[],slots:[],defaultStyle:{},defaultConfig:{}}}}]);
